## Open eClass 2.3

Το repository αυτό περιέχει μια __παλιά και μη ασφαλή__ έκδοση του eclass.
Προορίζεται για χρήση στα πλαίσια του μαθήματος
[Προστασία & Ασφάλεια Υπολογιστικών Συστημάτων (ΥΣ13)](https://crypto.di.uoa.gr/csec/), __μην τη
χρησιμοποιήσετε για κάνενα άλλο σκοπό__.


## 2020 Project 1

Εκφώνηση: https://crypto.di.uoa.gr/csec/assets/projects/project1.pdf


### Προσωπικά στοιχεία

__Όνομα__:  Νικόλαος Γαλάνης | Εμμανουήλ Κάσδαγλης

__Α.Μ.__: 1115201700019      | 1115201700049

### Defence 

TODO:

 - Change the uid of admin (from sql)
 - Add sql code 
 - Add an .httaccess file with " Options -Indexes " in it, to prevent users from viewing the directories (done)
 - Change admin directory name (carefull, change include files too)
 - Delete directories that are not needed (everything except the required ones)
 - All html code is saved in tool_content. Apply htmlspecialchars(), before shown on html content, or even better, before stored (done!)
 - Prepared statements for EVERY sql query
 - CSRF: Add tokens wherever a form is submited
 - Remove restore_course and other stupid stuff
 - Rename `$mysqlPassword` to something else
 - Rename database(if possible)


### Report

Κληθήκαμε να προστατεύσουμε μία παλία έκδοση του OpenEclass, η οποία είχε πολλά κενά ασφαλείας, και μπορούσε κάποιος να την σπάσει με κάθε μορφής επίθεση που αναφέρθηκε στο μάθημα. Επικεντρώσαμε την αναζήτηση για vunerabilities του site στις κατηγορίες των εξής επιθέσεων: __XSS attacks, SQL Injections, File Inclusions, Cross-site request forgery__. Τα αποτελέσματα της αναζήτησής μας, οι ενέργειές μας για να καλύψουμε τις ελείψεις, αλλά και οι ενέργεις για να επιτεθούμε στην αντίπαλη ομάδα είναι οι εξής:

#### XSS

#### SQL

#### File Inclusions

#### CSRF

Επίσης, γνωρίζαμε πως οι αντίπαλοι είχαν ήδη δει τον κώδικα της ιστοσελίδας, και επομένως τους ήταν πολύ εύκολο να γνωρίζουν ονόματα φακέλων, αρχείων και μεταβλητών. Για αυτόν τον λόγο κάναμε μερικές περεταίρω αλλαγές, ώστε να αποκρύψουμε μερικά πράγματα, στα πλαίσια που δεν άλλαζε η λειτουργικότητα της σελίδας. Επιπλέον, κάναμε μερικές παραδοχές, σύμφωνα με αυτά που είχαν συζητηθεί και στο piazza. Οι περεταίρω ενέργειές μας είναι οι εξής:

  - __Αλλάξαμε το uid του drunkadmin απο 1 σε 13__. Πολλά sql injections βασίζονται στο γεγονός οτι ο διαχειριστής έχει user_id ίσον με το 1, οπότε με αυτόν τον τρόπο δυσκολεύουμε ακόμα περισσότερο τους αντιπάλους μας από το να εκτελέσσουν ένα sql injection.
  - __Αλλάξαμε το όνομα του directory που αναφέρεται σε λειτουρργίες διαχειριστή__. Κανονικά, ο αντίπαλος δεν πρέπει ποτέ να αποκτήσει πρόσβαση σε περιεχόμενο του καταλόγου admin. Για να είμαστε σίγουροι όμως οτι δεν υπάρχει κάποιο περιθώριο να πάρει δεδομένα "μαντεύοντας" ένα link σε αυτόν τον φάκελο, τον μετονομάσαμε, ώστε οποιοδήποτε link και αν περιείχε στο path τον φάκελο admin να επέστρεφε 404.
  - __Διαγράψαμε τους φακέλους και τα αρχεία που αναφέρονταν σε λειτουργίες που δεν χρειαζόταν να είναι ενεργοποιημένες__. Στην εκφώνηση αναφέρονταν οι λειτουργίες οι οποίες έπρεπε να είναι ενεργές για το μάθημα που έχει δημιουργηθεί. Οι υπόλοιπες, σε συνδυασμό με αυτές που δεν είναι απαραίτητες για την λειτουργία του eclass(αναζήτηση, στατιστικά κλπ) αφαιρέθηκαν διαγράφοντας τα αρχεία. Έτσι, ακόμα και αν κάποιος αποκτούσε πρόσβαση ώς καθηγητής στο site μας, δεν θα μπορούσε να ενεργοποιήσει τις υπόλοιπες (απροστάτευτες) λειτουργίες.
  - __Αλλάξαμε το όνομα της μεταβλητής mysqlpassword στο αρχείο config__. Ένας άλλος τρόπος στον οποίον βασίστηκαν μερικές από τις επιθέσεις μας, ήταν να μάθουμε την τιμή αυτής της μεταβλητής, η οποία περιέχει σαν plain text τον κωδικό του διαχειριστή της βάσης (ο οποίος στο αντίπαλο site πιθανώς να είναι ίδιος και με του drunkadmin). Επομένως αλλάξαμε το όνομα αυτής της μεταβλητής, ώστε ακόμα και αν ο αντίπαλος αποκτούσε πρόσβαση στο αρχείο config, να μην μπορούσε να εμφανίσει την μεταβλητή με το αρχίκο της όνομα.

