# Defence
The following report states all the possible defence patches that were found in the website.

## XSS

To address these vulnerabilities, we applied the function `htmlspecialchars ()` in all cases where there is user input, __across the eclass__ area, even on administrator pages. Our reasoning was that even if the opponent gained access to admin content, they should not be able to perform xss attacks. We enforced our defense in all kinds of forms, before entering the data in the database, and for forms that were not stored in the database (eg lesson discussions), both in data formatting and printing (better safe than sorry). 

We noticed that each user input, to appear on the page, was stored in the variable `tool_content`. So we focused on this variable. Also, when the user was asked to fill in some kind of form, we filtered the data before they were entered and stored in the database.


## File Injections

To address the vulnerabilities, we did the following:

 - We created a `.htaccess` file, which disabled the ability to see the list tree, and therefore, combined with the fact that the folder names are random, the opponent could not find the location of the files he uploaded so that to run them.
 - We filtered the upload of files, so that files with suspicious endings, such as `.php`,` .js`, `.sh`, etc., are not allowed to be uploaded, so that even if in some way the opponent gained access to the folder, could not run the files.
 - We made changes to the names of critical folders, files and variables so that in case someone managed to access them, they could not find them.
 - We scanned the site for cases that included a variable entered by the user, and prevented the entry of "../", which probably led to a folder that should not be in the domain.
 - Before submitting the final file to `work` and to `file exchange`, we scan if there is any `<?php` in it, and if this is the case, we prevent it from being uploaded.

## SQL Injections

For the security of the site, the technique of the prepared statements in the queries was selected. The files in which these queries are located are:
 - modules / auth / opencourses.php
 - modules / auth / newuser.php
 - modules / auth / listfaculte.php
 - modules / work / work.php

In other files that required integers as user inputs, the `intval()` function was used.

## CSRF

We decided in every form to defend our site with the __CSRF tokens__ technique. In index.php, which the user enters by connecting to eclass, we create a global variable that holds a randomly generated token, specifically the variable `$ _SESSION ['token']`. Then, each time a new form is created for an eclass function (usually append in the variable `$ toolContent`), we add as a hidden field a variable `form_token`, where it takes the value of the token that has previously been generated. Finally, when each page processes the form it has received, it calls the `check_token ()` function, and performs the action provided if this function returns True. This function is implemented in the `html/include/lib/main.lib.php` file, along with other functions for security reasons, and checks if there is a token in the form, and if the value of the token in the form is equal to the variable `$ _SESSION ['token']`.

Another action we took to secure our application from CSRF attacks was __to change the name of the folder in which the administrator's content is located__, from admin to eclass_admin. We know that the opponents had first-hand experience of where the links for pages with forms are located (which are mainly on administrator pages).

